server {
    listen 80;
    
    # 启用动态解析 (避免 host not found 错误)
    resolver 127.0.0.11 valid=30s; 

    # ✅ 正确：使用 Dockerfile 复制的目标路径
    root /usr/share/nginx/html;
    index index.html;
    # ... 其他静态文件配置

    # 捕获所有以 /api/ 开头的请求
    location /api/ {
        # 1. 设置目标地址变量 (使用变量强制动态解析)
        set $api_target "http://backend:8000"; 
        
        # 2. 转发请求
        # proxy_pass 会将请求 URI (例如 /api/meta_data) 完整地附加到目标地址后面
        # 转发后的地址是： http://backend:8000/api/meta_data
        proxy_pass $api_target$request_uri; 
        
        # 3. 设置必要的头部信息
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
